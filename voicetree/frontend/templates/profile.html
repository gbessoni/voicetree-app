<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ user.display_name }} - VoiceTree</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body class="profile-page">
    <div class="container profile-container">
        <header class="profile-header">
            <div class="avatar">
                {% if user.avatar_url %}
                    <img src="{{ user.avatar_url }}" alt="{{ user.display_name }}">
                {% else %}
                    <div class="avatar-placeholder">{{ user.display_name[0].upper() }}</div>
                {% endif %}
            </div>
            <h1 class="profile-name">{{ user.display_name }}</h1>
            <p class="profile-username">@{{ user.username }}</p>
            {% if user.bio %}
                <p class="profile-bio">{{ user.bio }}</p>
            {% endif %}

            {% if voice_bio %}
                <div class="voice-bio-player">
                    <audio controls>
                        <source src="{{ voice_bio.audio_url }}" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                </div>
            {% endif %}
        </header>

        <main class="links-section">
            {% if links %}
                <div class="links-container">
                    {% for link in links %}
                        <a href="{{ link.url }}" class="link-card" target="_blank" rel="noopener noreferrer">
                            <div class="link-content">
                                <h3 class="link-title">{{ link.title }}</h3>
                                {% if link.description %}
                                    <p class="link-description">{{ link.description }}</p>
                                {% endif %}
                            </div>
                            <div class="link-arrow">â†’</div>
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                <div class="no-links">
                    <p>No links added yet.</p>
                </div>
            {% endif %}
        </main>

        <section class="voice-bio-submission">
            <h2>Create Your Voice Bio</h2>
            <form id="voice-bio-form">
                <textarea id="voice-bio-text" name="text" maxlength="500" placeholder="Enter your voice bio text (max 500 characters)"></textarea>
                <button type="submit">Generate Voice Bio</button>
            </form>
            <div id="form-message"></div>
        </section>

        <footer class="profile-footer">
            <p>Create your own <a href="/">VoiceTree</a> ðŸŒ³</p>
        </footer>
    </div>
    <script>
        document.getElementById('voice-bio-form').addEventListener('submit', async function(event) {
            event.preventDefault();

            const text = document.getElementById('voice-bio-text').value;
            const username = "{{ user.username }}";
            const messageDiv = document.getElementById('form-message');

            try {
                const response = await fetch(`/api/users/${username}/voice`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ text: text })
                });

                if (response.ok) {
                    messageDiv.textContent = 'Voice bio submitted for approval!';
                    messageDiv.style.color = 'green';
                } else {
                    const error = await response.json();
                    messageDiv.textContent = `Error: ${error.detail}`;
                    messageDiv.style.color = 'red';
                }
            } catch (error) {
                messageDiv.textContent = 'An unexpected error occurred.';
                messageDiv.style.color = 'red';
            }
        });
    </script>
</body>
</html>
